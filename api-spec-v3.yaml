openapi: 3.0.0
servers:
  # Added by API Auto Mocking Plugin
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/matthewminish/seng302-2021-api-spec/3.0.1

info:
  description: API specification for the SENG302 2021 project
  version: 3.3.2
  title: Wasteless
  contact:
    email: seng302@canterbury.ac.nz
  license:
    name: Apache 2.0
    url: 'http://www.apache.org/licenses/LICENSE-2.0.html'

tags:
  # User stories
  - name: 'U1: Registering and logging into an individual account'
  - name: 'U2: Cities, States/Regions, Countries'
    description: 'This story is implemented inside the client alone, and as such requires no associated API endpoints to be created'
  - name: 'U3: Searching for Users using Name'
  - name: 'U4: Default Global Application Admin (DGAA)'
  - name: 'U5: Creating Business Accounts'
  - name: 'U6: Acting as Individual or Business'
    description: 'All necessary API endpoints are found in prior stories'
  - name: 'U13: Home page'
    description: 'No endpoints required for this story specifically, but several will likely be used from prior and latter stories'
  - name: 'U15: Product Catalogue'
  - name: 'U16: Product Images'
  - name: 'U17: Modify catalogue entries'
  - name: 'U19: Create inventory'
  - name: 'U20: Modify inventory entries'
  - name: 'U22: List sale'
  - name: 'UCM1: Community marketplace'
    description: 'No endpoints required here yet, these will come from the subsequent stories'
  - name: 'UCM2: Card creation'
  - name: 'UCM3: Marketplace section display'
  - name: 'UCM4: Card expiry'
  - name: 'UCM5: Find my cards'
  - name: 'UCM6: Keyword management'
  - name: 'UCM7: Keyword search'
  - name: 'UCM8: Contacting other marketplace users'
  - name: 'U23: Search for business'
  - name: 'UCM9: Edit card'
  - name: 'U28: Product search'
  - name: 'U10: Modifying Individuals'
  - name: 'U11: Modifying Businesses'
  - name: 'U29: Browse/Search Sale Listings'
  - name: 'U30: Individual full sale listing'
  - name: 'U31: Purchases'
  - name: 'U32: Managing my feed'
  # Entities
  - name: 'Users'
    description: 'Grouping of endpoints related to the User entity'
  - name: 'Business Accounts'
    description: 'Grouping of endpoints related to Business Accounts'
  - name: 'Catalogue / Products'
    description: 'Grouping of endpoints related to Product entities'
  - name: 'Inventory'
    description: 'Grouping of endpoints related to business inventories'
  - name: 'Listings / sales'
    description: 'Grouping of endpoints related to listings of items and the sales of these listings'
  - name: 'Cards / community marketplace'
    description: 'Grouping of endpoints related to the community marketplace, and the cards the are created for it'
  - name: 'Keywords'
    description: 'Grouping of endpoints related to system-wide keywords that can be added by users and attached to marketplace cards'
  - name: 'Messages'
    description: 'Grouping of endpoints related to messages that marketplace users contact each other with'
  - name: 'Notifications'
    description: 'Grouping of endpoints related to notifications'

security:
  - CookieAuth:
      - user
      - globalApplicationAdmin
      - defaultGlobalApplicationAdmin

paths:
  '/login':
    post:
      tags:
        - 'U1: Registering and logging into an individual account'
        - 'Users'
      summary: Attempt to authenticate a user account with a username and password
      security: [ ]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  description: Email address of user account for login attempt
                  example: johnsmith99@gmail.com
                password:
                  type: string
                  format: password
                  description: Plain text user password
                  example: '1337-H%nt3r2'
      responses:
        '200':
          $ref: '#/components/responses/AuthenticatedResponse'
        '400':
          description: Failed login attempt, email or password incorrect

  '/users':
    post:
      tags:
        - 'U1: Registering and logging into an individual account'
        - 'Users'
      summary: Create a new user account
      security: [ ]
      responses:
        '201':
          $ref: '#/components/responses/AuthenticatedResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '409':
          description: Email address already in use
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
        description: New user account data, id will be generated automatically by the server

  '/users/{id}':
    get:
      tags:
        - 'U1: Registering and logging into an individual account'
        - 'Users'
      summary: Retrieve a specific user account
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: User ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Account retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/users/search':
    get:
      tags:
        - 'U3: Searching for Users using Name'
        - 'Users'
      summary: 'Search for users by some criteria, for now: their name'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - in: query
          name: searchQuery
          schema:
            type: string
          required: true
          description: 'Criteria to search users for, e.g: userâ€™s full name or one or more of their names/nickname'
      responses:
        '200':
          description: Request successful, a (possibly empty) list of users is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  '/users/{id}/makeadmin':
    put:
      tags:
        - 'U4: Default Global Application Admin (DGAA)'
        - 'Users'
      summary: Promote a user account to the Global Application Admin role
      security:
        - CookieAuth:
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: User ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Action completed successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/users/{id}/revokeadmin':
    put:
      tags:
        - 'U4: Default Global Application Admin (DGAA)'
        - 'Users'
      summary: Revokes the Global Application Admin role from a user account
      security:
        - CookieAuth:
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: User ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Action completed successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'
        '409':
          description: "Returned when the DGAA tries to revoke their own admin status, this is not an allowed action."

  '/businesses':
    post:
      tags:
        - 'U5: Creating Business Accounts'
        - 'Business Accounts'
      summary: Create a new business entity
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Business'
        description: New business account data, id will be generated automatically by the server
      responses:
        '201':
          description: Business account created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  businessId:
                    type: integer
                    description: The ID of the business that has just been created
                    example: 100
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  '/businesses/{id}':
    get:
      tags:
        - 'U5: Creating Business Accounts'
        - 'Business Accounts'
      summary: Retrieve a specific business account
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: Business ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Business retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Business'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/businesses/{id}/makeAdministrator':
    put:
      tags:
        - 'U5: Creating Business Accounts'
        - 'Business Accounts'
      summary: Add an individual as an administrator for a business
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: Business ID
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: integer
                  description: The ID of the user to add as a business administrator
                  example: 100
      responses:
        '200':
          description: Individual added as an administrator successfully
        '400':
          description: The individual could not be added as an administrator, perhaps because it does not exist or is already an administrator.
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "Forbidden: Returned when the user making the request is not the primary administrator of the business AND is not a global application admin."
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/businesses/{id}/removeAdministrator':
    put:
      tags:
        - 'U5: Creating Business Accounts'
        - 'Business Accounts'
      summary: Remove an individual from administering a business
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: Business ID
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: integer
                  description: The ID of the user to remove as a business administrator
                  example: 100
      responses:
        '200':
          description: Inidividual removed from administering successfully
        '400':
          description: The individual could not be removed from administering the business, perhaps because it does not exist, was not an administrator of the business, or is the primary administrator of the business.
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "Forbidden: Returned when the user making the request is not the primary administrator of the business AND is not a global application admin."
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/businesses/{id}/products':
    get:
      tags:
        - 'U15: Product Catalogue'
        - 'Business Accounts'
        - 'Catalogue / Products'
      summary: "Retrieve all the products in a business's catalogue"
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: Business ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Catalogue retrieved successfully. This could be an empty array.'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'The account performing the request is neither an administrator of the business, nor a global application admin.'
        '406':
          $ref: '#/components/responses/NotAcceptableError'
    post:
      tags:
        - 'U15: Product Catalogue'
        - 'Business Accounts'
        - 'Catalogue / Products'
      summary: "Add a new product to a business's catalogue"
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: Business ID
          required: true
          schema:
            type: integer
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  productId:
                    type: string
                    description: The ID of the product that has just been created
                    example: "WATT-420-BEANS"
        '400':
          description: There was some error with the data supplied by the user, appropriate error message(s) should be shown to user
        '403':
          description: 'Forbidden: Returned when a user tries to add a product to business they do not administer AND the user is not a global application admin'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'

  '/businesses/{businessId}/products/{productId}/images':
    post:
      tags:
        - 'U16: Product Images'
        - 'Catalogue / Products'
      summary: Upload a new image for some photo
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: businessId
          in: path
          description: ID of business to search catalogue of
          required: true
          schema:
            type: integer
        - name: productId
          in: path
          description: ID (Product Code) of product to try to find in catalogue
          required: true
          schema:
            type: string
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                filename:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        '201':
          description: Image created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  imageId:
                    type: integer
                    description: The ID of the image that has just been created
                    example: 1234
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned when a user tries to add an image for a product that it is in a catalogue for a business they do not administer AND the user is not a global application admin'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/businesses/{businessId}/products/{productId}/images/{imageId}':
    delete:
      tags:
        - 'U16: Product Images'
        - 'Catalogue / Products'
      summary: Delete an image of a product
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: businessId
          in: path
          description: ID of business that owns product
          required: true
          schema:
            type: integer
        - name: productId
          in: path
          description: ID (Product Code) of product to delete image for
          required: true
          schema:
            type: string
        - name: imageId
          in: path
          description: ID of the image to delete
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Image deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned when a user tries to delete an image for a product that it is in a catalogue for a business they do not administer AND the user is not a global application admin'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/businesses/{businessId}/products/{productId}/images/{imageId}/makeprimary':
    put:
      tags:
        - 'U16: Product Images'
        - 'Catalogue / Products'
      summary: Set an existing image to be the new primary image for some product
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: businessId
          in: path
          description: ID of business that owns product
          required: true
          schema:
            type: integer
        - name: productId
          in: path
          description: ID (Product Code) of product to update primary image for
          required: true
          schema:
            type: string
        - name: imageId
          in: path
          description: ID of the image to set as being the primary image for product
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Primary image successfully updated
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned when a user tries to update the primary image for a product that it is in a catalogue for a business they do not administer AND the user is not a global application admin'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/businesses/{businessId}/products/{productId}':
    put:
      tags:
        - 'U17: Modify catalogue entries'
        - 'Catalogue / Products'
      summary: Modify an existing catalogue item
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: businessId
          in: path
          description: ID of business to search catalogue of
          required: true
          schema:
            type: integer
        - name: productId
          in: path
          description: ID (Product Code) of product to try to find in catalogue
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'
      responses:
        '200':
          description: Product updated successfully
        '400':
          description: There was some error with the data supplied by the user, appropriate error message(s) should be shown to user
        '403':
          description: 'Forbidden: Returned when a user tries to update a product for a business they do not administer AND the user is not a global application admin'

  '/businesses/{id}/inventory/':
    get:
      tags:
        - 'U19: Create inventory'
        - 'Business Accounts'
        - 'Inventory'
      summary: "Retrieve a business's product inventory"
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: Business ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Inventory retrieved successfully. This could be an empty array.'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InventoryItem'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'The account performing the request is neither an administrator of the business, nor a global application admin.'
        '406':
          $ref: '#/components/responses/NotAcceptableError'
    post:
      tags:
        - 'U19: Create inventory'
        - 'Business Accounts'
        - 'Inventory'
      summary: "Add a new inventory item to a business's inventory"
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: Business ID
          required: true
          schema:
            type: integer
      responses:
        '201':
          description: Inventory item created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  inventoryItemId:
                    type: integer
                    description: The ID of the inventory item that has just been created
                    example: 101
        '400':
          description: There was some error with the data supplied by the user, appropriate error message(s) should be shown to user
        '403':
          description: 'Forbidden: Returned when a user tries to add an inventory item to the inventory of a business they do not administer AND the user is not a global application admin'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InventoryItem'

  '/businesses/{businessId}/inventory/{inventoryItemId}':
    put:
      tags:
        - 'U20: Modify inventory entries'
        - 'Business Accounts'
        - 'Inventory'
      summary: Modify an existing inventory item
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: businessId
          in: path
          description: ID of business to search catalogue of
          required: true
          schema:
            type: integer
        - name: inventoryItemId
          in: path
          description: ID of inventory item to update
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InventoryItem'
      responses:
        '200':
          description: Inventory item updated successfully
        '400':
          description: There was some error with the data supplied by the user, appropriate error message(s) should be shown to user
        '403':
          description: 'Forbidden: Returned when a user tries to update an inventory item for a business they do not administer AND the user is not a global application admin'

  '/businesses/{id}/listings':
    get:
      tags:
        - 'U22: List sale'
        - 'Business Accounts'
        - 'Listings / sales'
      summary: "Retrieve a business's listings"
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: Business ID
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Listings retrieved successfully. This could be an empty array.'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Listing'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'
    post:
      tags:
        - 'U22: List sale'
        - 'Business Accounts'
        - 'Listings / sales'
      summary: "Add a new listing for some inventory item of a business"
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: Business ID
          required: true
          schema:
            type: integer
      responses:
        '201':
          description: Listing created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  listingId:
                    type: integer
                    description: The ID of the listing that has just been created
                    example: 57
        '400':
          description: There was some error with the data supplied by the user, appropriate error message(s) should be shown to user
        '403':
          description: 'Forbidden: Returned when a user tries to add listing for a business they do not administer AND the user is not a global application admin'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Listing'

  '/cards':
    post:
      tags:
        - 'UCM2: Card creation'
        - 'Cards / community marketplace'
      summary: "Create a new card to go on the community marketplace"
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      responses:
        '201':
          description: Card created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  cardId:
                    type: integer
                    description: The ID of the card that has just been created
                    example: 500
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Returned if a user who is not a GAA tries to create a card for somebody else.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Card'
    get:
      tags:
        - 'UCM2: Card creation'
        - 'Cards / community marketplace'
      summary: 'Retrieve all cards for a given section'
      parameters:
        - name: section
          in: query
          description: The section for which cards should be retrieved.
          required: true
          schema:
            type: string
            enum:
              - ForSale
              - Wanted
              - Exchange
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      responses:
        '200':
          description: Request successful, a (possibly empty) list of cards is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Card'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  '/cards/{id}':
    get:
      tags:
        - 'UCM3: Marketplace section display'
        - 'Cards / community marketplace'
      summary: 'Retrieve a specific card'
      parameters:
        - name: id
          in: path
          description: The id of the card to get.
          required: true
          schema:
            type: integer
            example: 500
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      responses:
        '200':
          description: Request successful, a card is returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'
    delete:
      tags:
        - 'UCM4: Card expiry'
        - 'Cards / community marketplace'
      summary: Delete a community marketplace card
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: The id of the card to get.
          required: true
          schema:
            type: integer
            example: 500
      responses:
        '200':
          description: Card deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned when a user tries to delete a card that they are not the creator of AND the user is not a GAA'
        '406':
          $ref: '#/components/responses/NotAcceptableError'
    put:
      tags:
        - 'UCM9: Edit card'
        - 'Cards / community marketplace'
      summary: Modify an existing card
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: id
          in: path
          description: The id of the card to edit.
          required: true
          schema:
            type: integer
            example: 500
      requestBody:
        content:
          application/json:
            schema:
              type: object
              description: Represents an item in the Community Marketplace
              required:
                - title
                - section
                - keywordIds
                - description
              properties:
                id:
                  type: integer
                  example: 500
                  readOnly: true
                  description: Unique ID, autogenerated by the system
                section:
                  type: string
                  enum:
                    - ForSale
                    - Wanted
                    - Exchange
                created:
                  type: string
                  format: date-time
                  example: '2021-07-15T05:10:00Z'
                  readOnly: true
                  description: Date and time when the card was created
                displayPeriodEnd:
                  type: string
                  format: date-time
                  example: '2021-07-29T05:10:00Z'
                  readOnly: true
                  description: Date and time when the display period of the card is set to expire. This defaults to 2 weeks from creation, and can be extended per UCM4.
                title:
                  type: string
                  description: Title of the card, should be suitable for one-line displays.
                  example: "1982 Lada Samara"
                description:
                  type: string
                  description: A more detailed description of the card.
                  example: "Beige, suitable for a hen house. Fair condition. Some rust. As is, where is. Will swap for budgerigar."
                keywords:
                  type: array
                  readOnly: true
                  description: Keywords describing the card. A card can have one or more keywords associated with it.
                  items:
                    $ref: '#/components/schemas/Keyword'
                keywordIds:
                  type: array
                  writeOnly: true
                  description: The IDs of keywords that will be associated with a card once it is created. These keywords are created through the POST /keywords endpoints (UCM6).
                  items:
                    type: integer
                    example: [ 20, 15, 600 ]
      responses:
        '200':
          description: Card updated successfully
        '400':
          description: There was some error with the data supplied by the user, appropriate error message(s) should be shown to user
        '403':
          description: 'Forbidden: Returned when a user tries to update a card they are not the creator of AND the user is not a global application admin'


  '/cards/{id}/extenddisplayperiod':
    put:
      tags:
        - 'UCM4: Card expiry'
        - 'Cards / community marketplace'
      summary: 'Extend the display period of a card that is nearing expiry'
      parameters:
        - name: id
          in: path
          description: The id of the card to get.
          required: true
          schema:
            type: integer
            example: 500
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      responses:
        '200':
          description: End of display period successfully extended. Extension amount should be a further two weeks.
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned when a user who is neither the creator of the card, nor a GAA, tries to extend the display period of the card.'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/users/{id}/cards':
    get:
      tags:
        - 'UCM5: Find my cards'
        - 'Cards / community marketplace'
      summary: 'Retrieve all active cards that a user has created'
      parameters:
        - name: id
          in: path
          description: The id of the user for whom to get cards.
          required: true
          schema:
            type: integer
            example: 100
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      responses:
        '200':
          description: Request successful, a (possibly empty) list of cards is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Card'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/keywords':
    post:
      tags:
        - 'UCM6: Keyword management'
        - 'Keywords'
      summary: "Create a new system-wide keyword"
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      responses:
        '201':
          description: Keyword created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  keywordId:
                    type: integer
                    description: The ID of the keyword that has just been created
                    example: 600
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Keyword'

  '/keywords/search':
    get:
      tags:
        - 'UCM6: Keyword management'
        - 'Keywords'
      summary: 'Search for keywords by partial (or complete) name'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - in: query
          name: searchQuery
          schema:
            type: string
          required: true
          description: 'Criteria to search keywords for, all partial and complete matches are returned'
      responses:
        '200':
          description: Request successful, a (possibly empty) list of keywords is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Keyword'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  '/keywords/{id}':
    delete:
      tags:
        - 'UCM6: Keyword management'
        - 'Keywords'
      summary: 'Delete a keyword as an admin'
      security:
        - CookieAuth:
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: ID of keyword to delete
          example: 600
      responses:
        '200':
          description: Keyword successfully deleted
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned if a non-GAA user attempts to delete any card.'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/cards/search':
    get:
      tags:
        - 'UCM7: Keyword search'
        - 'Cards / community marketplace'
        - 'Keywords'
      summary: 'Search for cards based on some keywords'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - in: query
          name: keywordIds
          description: 'The IDs of keywords by which cards are being searched'
          schema:
            type: array
            items:
              type: integer
          required: true
        - name: section
          in: query
          description: The section for which cards should be retrieved.
          required: true
          schema:
            type: string
            enum:
              - ForSale
              - Wanted
              - Exchange
        - in: query
          name: union
          description: Whether or not to get cards that match ANY of the keywords, or only cards that match ALL of the keywords. True = Match ANY, False = Match ALL
          schema:
            type: boolean
          required: true
      responses:
        '200':
          description: Request successful, a (possibly empty) list of cards is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Card'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'


  '/businesses/search':
    get:
      tags:
        - 'U23: Search for business'
        - 'Business Accounts'
      summary: 'Search for businesses by some criteria, for now: their name'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - in: query
          name: searchQuery
          schema:
            type: string
          required: true
          description: 'Criteria to search businesses for, e.g: businessâ€™s full name or part of a name'
        - in: query
          name: businessType
          description: |-
            Only include businesses of this type (id).

            Only valid business types are allowed.
          schema:
            type: string
      responses:
        '200':
          description: Request successful, a (possibly empty) list of businesses is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Business'
        '400':
          description: Bad Request, businessType is not a valid business type
        '401':
          $ref: '#/components/responses/UnauthorizedError'


  '/users/{userId}/cards/{cardId}/messages':
    post:
      tags:
        - 'UCM8: Contacting other marketplace users'
        - 'Messages'
      summary: 'Creates a message about a marketplace card'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: userId
          in: path
          description: The id of the user the message is for
          required: true
          schema:
            type: integer
            example: 100
        - name: cardId
          in: path
          description: The id of the card the message is about
          required: true
          schema:
            type: integer
            example: 100
      responses:
        '201':
          description: 'Message successfully created'
          content:
            application/json:
              schema:
                type: object
                properties:
                  messageId:
                    type: integer
                    description: The ID of the message that has just been created
                    example: 600
        '400':
          description: Bad Request
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                text:
                  type: string
                  description: The message content
                  example: "Hi, how much do you want for the apples?"

  '/users/{userId}/messages':
    get:
      tags:
        - 'UCM8: Contacting other marketplace users'
        - 'Messages'
      summary: 'Gets all messages for a user'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: userId
          in: path
          description: The id of the user the message is for
          required: true
          schema:
            type: integer
            example: 100
      responses:
        '200':
          description: Request successful, a (possibly empty) list of messages is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Message'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned if anyone but the user with id userId, or GAA attempts to get users messages.'
        '406':
          $ref: '#/components/responses/NotAcceptableError'


  '/users/{userId}/messages/{messageId}':
    delete:
      tags:
        - 'UCM8: Contacting other marketplace users'
        - 'Messages'
      summary: 'Deletes a message'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: userId
          in: path
          description: The id of the user the message is for
          required: true
          schema:
            type: integer
            example: 100
        - name: messageId
          in: path
          description: The id of the message to delete
          required: true
          schema:
            type: integer
            example: 100
      responses:
        '200':
          description: Message successfully deleted
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned if anyone but the user with id userId, or GAA attempts to delete users messages.'
        '406':
          $ref: '#/components/responses/NotAcceptableError'


  '/users/{userId}/notifications':
    get:
      tags:
        - 'Notifications'
      summary: 'Gets all of a users notifications'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: userId
          in: path
          description: The ID of the user to get notifications for
          required: true
          schema:
            type: integer
            example: 100
      responses:
        200:
          description: Request successful, a (possibly empty) list of notifications is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserNotification'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          description: 'Forbidden: returned if someone who is not a GAA attempts to get another users notifications'
        406:
          $ref: '#/components/responses/NotAcceptableError'

  '/users/{userId}/notifications/{notificationId}':
    delete:
      tags:
        - 'Notifications'
      summary: 'Deletes a user notification'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: userId
          in: path
          description: The ID of the user to delete a notification of
          required: true
          schema:
            type: integer
            example: 100
        - name: notificationId
          in: path
          description: The ID of the notification to delete
          required: true
          schema:
            type: integer
            example: 100
      responses:
        200:
          description: Request successful, notification deleted
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          description: 'Forbidden: returned if someone who is not a GAA attempts to delete another users notification'
        406:
          $ref: '#/components/responses/NotAcceptableError'

  '/notifications':
    get:
      tags:
        - 'Notifications'
      summary: 'Gets all admin notifications'
      security:
        - CookieAuth:
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      responses:
        200:
          description: Request successful, a (possibly empty) list of admin notifications
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AdminNotification'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          description: 'Forbidden: returned if someone who is not a GAA attempts to get admin notifications'

  '/notifications/{notificationId}':
    delete:
      tags:
        - 'Notifications'
      summary: 'Deletes an admin notification'
      security:
        - CookieAuth:
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: notificationId
          in: path
          description: ID of the admin notification to delete
          required: true
          schema:
            type: integer
            example: 100
      responses:
        200:
          description: Request successful, admin notification deleted
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          description: 'Forbidden: returned if someone who is not a GAA attempts to delete an admin notification'
        406:
          $ref: '#/components/responses/NotAcceptableError'

  '/businesses/{businessId}/products/search':
    get:
      tags:
        - 'U28: Product search'
        - 'Catalogue / Products'
      summary: 'Search for product by any of the product text fields'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: businessId
          in: path
          description: ID of business to search catalogue of
          required: true
          schema:
            type: integer
        - in: query
          name: searchQuery
          schema:
            type: string
          required: true
          description: 'Criteria to search product by, e.g: part of the product id or name'
        - in: query
          name: matchingId
          schema:
            type: boolean
          required: false
          description: 'Whether the Id field is being searched by'
        - in: query
          name: matchingName
          schema:
            type: boolean
          required: false
          description: 'Whether the Name field is being searched by'
        - in: query
          name: matchingDescription
          schema:
            type: boolean
          required: false
          description: 'Whether the Description field is being searched by'
        - in: query
          name: matchingManufacturer
          schema:
            type: boolean
          required: false
          description: 'Whether the Manufacturer field is being searched by'
        - in: query
          name: orderBy
          schema:
            type: string
          required: false
          description: 'Orders the results, can be productName, country, city, expiryDateAsc, expiryDateDesc, seller, priceAsc, priceDesc'
        - in: query
          name: page
          schema:
            type: integer
          required: false
          description: 'Determines which "page" of results to return. 1st page will be returned if not specified.'
      responses:
        '200':
          description: Request successful, a (possibly empty) list of products is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'


  '/users/{userId}':
    put:
      tags:
        - 'U10: Modifying Individuals'
        - 'Users'
      summary: Modify an existing user
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: userId
          in: path
          description: ID of user to edit
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EditUser'
      responses:
        '200':
          description: User updated successfully
        '400':
          description: There was some error with the data supplied by the user, appropriate error message(s) should be shown to user
        '403':
          description: 'Forbidden: Returned when a user tries to update another user AND the user is not a global application admin'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/users/{userId}/images':
    post:
      tags:
        - 'U10: Modifying Individuals'
        - 'Users'
      summary: Upload a new image for some user
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: userId
          in: path
          description: ID of user to edit
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                filename:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        '201':
          description: Image created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  imageId:
                    type: integer
                    description: The ID of the image that has just been created
                    example: 1234
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned when a user tries to add an image for a user that is not them AND the user is not a global application admin'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/users/{userId}/images/{imageId}/makeprimary':
    put:
      tags:
        - 'U10: Modifying Individuals'
        - 'Users'
      summary: Set an existing image to be the new primary image for some user
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: userId
          in: path
          description: ID of user to edit
          required: true
          schema:
            type: integer
        - name: imageId
          in: path
          description: ID of the image to set as being the primary image for user
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Primary image successfully updated
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned when a user tries to update the primary image for a user that is not them AND the user is not a global application admin'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/users/{userId}/images/{imageId}':
    delete:
      tags:
        - 'U10: Modifying Individuals'
        - 'Users'
      summary: Delete an image for a user
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: userId
          in: path
          description: ID of user to edit
          required: true
          schema:
            type: integer
        - name: imageId
          in: path
          description: ID of the image to delete
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Image deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned when a user tries to delete an image for a user that is not them AND the user is not a global application admin'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/businesses/{businessId}':
    put:
      tags:
        - 'U11: Modifying Businesses'
        - 'Business Accounts'
      summary: Modify an existing business
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: businessId
          in: path
          description: ID of business to edit
          required: true
          schema:
            type: integer
        - name: updateProductCurrency
          in: query
          description: Determines whether to update all current products to use the new currency specified.
          required: false
          schema:
            type: boolean
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Business'
      responses:
        '200':
          description: Business updated successfully
        '400':
          description: There was some error with the data supplied by the user, appropriate error message(s) should be shown to user
        '403':
          description: 'Forbidden: Returned when a user tries to update a business they do not administer AND the user is not a global application admin'
        '406':
          $ref: '#/components/responses/NotAcceptableError'


  '/businesses/{businessId}/images':
    post:
      tags:
        - 'U11: Modifying Businesses'
        - 'Business Accounts'
      summary: Upload a new image for some busines
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: businessId
          in: path
          description: ID of business to edit
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                filename:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        '201':
          description: Image created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  imageId:
                    type: integer
                    description: The ID of the image that has just been created
                    example: 1234
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned when a user tries to add an image for a business they dont administer AND the user is not a global application admin'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/businesses/{businessId}/images/{imageId}/makeprimary':
    put:
      tags:
        - 'U11: Modifying Businesses'
        - 'Business Accounts'
      summary: Set an existing image to be the new primary image for some business
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: businessId
          in: path
          description: ID of business to edit
          required: true
          schema:
            type: integer
        - name: imageId
          in: path
          description: ID of the image to set as being the primary image for product
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Primary image successfully updated
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned when a user tries to update the primary image for a business they dont administer AND the user is not a global application admin'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/businesses/{businessId}/images/{imageId}':
    delete:
      tags:
        - 'U11: Modifying Businesses'
        - 'Business Accounts'
      summary: Delete an image for a business
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: businessId
          in: path
          description: ID of business to edit
          required: true
          schema:
            type: integer
        - name: imageId
          in: path
          description: ID of the image to delete
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Image deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: 'Forbidden: Returned when a user tries to delete an image for a business that they dont administer is not them AND the user is not a global application admin'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/listings':
    get:
      tags:
        - 'U29: Browse/Search Sale Listings'
        - 'Listings / sales'
      summary: Get all, or a filtered selection, of the available sale listings
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - in: query
          name: searchQuery
          schema:
            type: string
          required: false
          description: 'Criteria to search listings by, e.g: part of the product or business name'
        - in: query
          name: matchingProductName
          schema:
            type: boolean
          required: false
          description: 'Whether we are using the searchQuery to match product names'
        - in: query
          name: matchingBusinessName
          schema:
            type: boolean
          required: false
          description: 'Whether we are using the searchQuery to match business names'
        - in: query
          name: matchingBusinessLocation
          schema:
            type: boolean
          required: false
          description: 'Whether we are using the searchQuery to match business locations'
        - in: query
          name: matchingBusinessType
          schema:
            type: boolean
          required: false
          description: 'Whether we are using the searchQuery to match business type'
        - in: query
          name: priceRangeLower
          schema:
            type: number
          required: false
          description: 'A lower bound on the price range'
        - in: query
          name: priceRangeUpper
          schema:
            type: number
          required: false
          description: 'An upper bound on the price range'
        - in: query
          name: closingDateLower
          schema:
            type: string
          required: false
          description: 'A lower bound on the closing date'
        - in: query
          name: closingDateUpper
          schema:
            type: string
          required: false
          description: 'An upper bound on the closing date'
        - in: query
          name: pageNumber
          schema:
            type: integer
          required: true
          description: 'The page to get'
        - in: query
          name: sortBy
          schema:
            type: string
          required: true
          description: 'The sorting parameter. One of "priceAsc", "priceDesc", "productName", "country", "city", "expiryDateAsc", "expiryDateDesc", "seller"'
      responses:
        '200':
          description: Request successful, a (possibly empty) list of listings is returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalCount:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Listing'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  '/listings/{listingId}/like':
    patch:
      tags:
        - 'U30: Individual full sale listing'
        - 'Listings / sales'
      summary: Adds a sale listing to the user's liked sale listings
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: listingId
          in: path
          description: ID of the listing to like
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Request successful
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'
  '/listings/{listingId}/unlike':
    patch:
      tags:
        - 'U30: Individual full sale listing'
        - 'Listings / sales'
      summary: Removes a sale listing from the user's liked sale listings
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: listingId
          in: path
          description: ID of the listing to unlike
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Request successful
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/listings/{listingId}/buy':
    post:
      tags:
        - 'U31: Purchases'
        - 'Listings / sales'
      summary: Purchases a sale listing
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - in: path
          name: listingId
          schema:
            type: integer
          required: true
          description: 'Sale listing to purchase'
      responses:
        '200':
          description: Request successful
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/listings/{listingId}/star':
    patch:
      tags:
        - 'U32: Managing my feed'
        - 'Listings / sales'
      summary: Stars & un-stars sale listings
      description: Stars or un-stars a sale listing based on the 'star' property in the request body.
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: listingId
          in: path
          description: ID of the listing to like
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                star:
                  type: string
      responses:
        '200':
          description: Request successful
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/users/{userId}/notifications/{notificationId}/read':
    patch:
      tags:
        - 'U32: Managing my feed'
        - 'Notifications'
      summary: 'Marks a user notification as read or unread'
      description: 'Marks the notification as either read or unread based on the "read" value in the request body.'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: userId
          in: path
          description: The ID of the user
          required: true
          schema:
            type: integer
            example: 100
        - name: notificationId
          in: path
          description: The ID of the notification
          required: true
          schema:
            type: integer
            example: 100
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                read:
                  type: boolean
      responses:
        200:
          description: Success
        400:
          $ref: '#/components/responses/BadRequestError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        406:
          $ref: '#/components/responses/NotAcceptableError'

  '/users/{userId}/messages/{messageId}/read':
    patch:
      tags:
        - 'U32: Managing my feed'
        - 'Messages'
      summary: 'Marks a message as read or unread'
      description: 'Marks the message as either read or unread based on the "read" value in the request body.'
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: userId
          in: path
          description: The id of the user the message is for
          required: true
          schema:
            type: integer
            example: 100
        - name: messageId
          in: path
          description: The id of the message to delete
          required: true
          schema:
            type: integer
            example: 100
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                read:
                  type: boolean
      responses:
        '200':
          description: Success
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/listings/{listingId}/tag':
    patch:
      tags:
        - 'U32: Managing my feed'
        - 'Listings / sales'
      summary: Sets the tag on a sale listing
      security:
        - CookieAuth:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: listingId
          in: path
          description: Tag to add to sale listing
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                tag:
                  $ref: '#/components/schemas/Tag'
      responses:
        '200':
          description: Request successful
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '406':
          $ref: '#/components/responses/NotAcceptableError'

  '/notifications/{notificationId}/read':
    patch:
      tags:
        - 'U32: Managing my feed'
        - 'Notifications'
      summary: 'Marks an admin notification as read or unread'
      description: 'Marks the notification as either read or unread based on the "read" value in the request body.'
      security:
        - CookieAuth:
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
      parameters:
        - name: notificationId
          in: path
          description: The ID of the notification
          required: true
          schema:
            type: integer
            example: 100
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                read:
                  type: boolean
      responses:
        200:
          description: Success
        400:
          $ref: '#/components/responses/BadRequestError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        406:
          $ref: '#/components/responses/NotAcceptableError'

components:
  securitySchemes:
    CookieAuth:
      type: apiKey
      in: cookie
      name: JSESSIONID
  responses:
    BadRequestError:
      description: There was some error with the data supplied by the user, appropriate error message(s) should be shown to user
    UnauthorizedError:
      description: Access token is missing or invalid
    ForbiddenError:
      description: The user does not have permission to perform the requested action
    NotAcceptableError:
      description: 'The requested route does exist (so not a 404) but some part of the request is not acceptable, for example trying to access a resource by an ID that does not exist.'
    AuthenticatedResponse:
      description: >
        Response returned to client when they have performed an action to gain authentication (registering or logging in).
        This response includes a session token that the client can use in future API requests to authenticate itself.
        This session token is set as a cookie with name 'JSESSIONID', and will need to be included in subsequent requests to the server.
      content:
        application/json:
          schema:
            type: object
            properties:
              userId:
                type: integer
                description: The ID of the user that has just been authenticated
                example: 100
      headers:
        Set-Cookie:
          schema:
            type: string
            example: JSESSIONID=abcde12345; Path=/; HttpOnly

  schemas:
    Message:
      type: object
      description: "Represents a message to a user, about a card"
      properties:
        id:
          type: integer
          example: 600
          readOnly: true
          description: Unique ID, autogenerated by the system
        text:
          type: string
          example: "Hi, how much do you want for the apples?"
        receiverId:
          type: integer
          example: 600
          readOnly: true
          description: Id of the user the message is for
        card:
          type: object
          allOf:
            - $ref: '#/components/schemas/Card'
        sender:
          type: object
          allOf:
            - $ref: '#/components/schemas/User'


    Keyword:
      type: object
      description: "Represents a single 'keyword' within the system - similar to a hashtag."
      properties:
        id:
          type: integer
          example: 600
          readOnly: true
          description: Unique ID, autogenerated by the system
        name:
          type: string
          description: The text value of the keyword
          example: Vehicle
        created:
          type: string
          format: date-time
          example: '2021-07-15T05:10:00Z'
          readOnly: true
          description: Date and time when the keyword was created

    Card:
      type: object
      description: Represents an item in the Community Marketplace
      required:
        - title
        - creatorId
        - section
        - keywordIds
      properties:
        id:
          type: integer
          example: 500
          readOnly: true
          description: Unique ID, autogenerated by the system
        creatorId:
          type: integer
          example: 100
          writeOnly: true
        creator:
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/User'
        section:
          type: string
          enum:
            - ForSale
            - Wanted
            - Exchange
        created:
          type: string
          format: date-time
          example: '2021-07-15T05:10:00Z'
          readOnly: true
          description: Date and time when the card was created
        displayPeriodEnd:
          type: string
          format: date-time
          example: '2021-07-29T05:10:00Z'
          readOnly: true
          description: Date and time when the display period of the card is set to expire. This defaults to 2 weeks from creation, and can be extended per UCM4.
        title:
          type: string
          description: Title of the card, should be suitable for one-line displays.
          example: "1982 Lada Samara"
        description:
          type: string
          description: A more detailed description of the card.
          example: "Beige, suitable for a hen house. Fair condition. Some rust. As is, where is. Will swap for budgerigar."
        keywords:
          type: array
          readOnly: true
          description: Keywords describing the card. A card can have one or more keywords associated with it.
          items:
            $ref: '#/components/schemas/Keyword'
        keywordIds:
          type: array
          writeOnly: true
          description: The IDs of keywords that will be associated with a card once it is created. These keywords are created through the POST /keywords endpoints (UCM6).
          items:
            type: integer
            example: [ 20, 15, 600 ]

    Listing:
      type: object
      description: A listing for the sale of some product from a business's inventory
      required:
        - inventoryItemId
        - quantity
        - price
      properties:
        id:
          type: integer
          example: 57
          readOnly: true
          description: A unique (within the business) identifer for this listing - autogenerated by the system
        inventoryItem:
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/InventoryItem'
        inventoryItemId:
          type: integer
          example: 101
          writeOnly: true
        quantity:
          type: integer
          example: 3
          description: Must be greater than zero, and less than or equal to the quantity of the correpsonding inventory entry
        price:
          type: number
          format: double
          description: Price of the listing
          example: 17.99
        moreInfo:
          type: string
          example: 'Seller may be willing to consider near offers'
          description: An optional field for further information about the listing
        created:
          type: string
          format: date-time
          example: '2021-07-14T11:44:00Z'
          readOnly: true
          description: Date and time when the listing was created
        closes:
          type: string
          format: date-time
          example: '2021-07-21T23:59:00Z'
          description: Date and time when the listing closes (defaults to expiry date of related inventory item)
        business:
          $ref: '#/components/schemas/Business'

    InventoryItem:
      type: object
      description: Entity representing an instance of a stock of some product
      required:
        - productId
        - quantity
        - expires
      properties:
        id:
          type: integer
          example: 101
          readOnly: true
          description: A unique (within the inventory) identifer for this item - autogenerated by the system
        product:
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/Product'
        productId:
          writeOnly: true
          type: string
          example: "WATT-420-BEANS"
          description: Product Code of corresponding product in business's catalogue. Notice that the ID is given when writing, but the full object is returned when reading
        quantity:
          type: integer
          example: 4
          description: How many items of stock are present
        pricePerItem:
          type: number
          format: double
          description: Price to purchase a single item of the product
          example: 6.50
        totalPrice:
          type: number
          format: double
          description: Price for purchasing the entire stock of the product
          example: 21.99
        manufactured:
          type: string
          format: date
          description: The date on which the product was prepared / manufactured
        sellBy:
          type: string
          format: date
          description: The date by which the product ought to be sold
        bestBefore:
          type: string
          format: date
          description: 'The "best before" date of the product'
        expires:
          type: string
          format: date
          description: The expiry date of the product

    Image:
      type: object
      description: Entity representing an image stored on the server
      required:
        - filename
        - thumbnailFilename
      properties:
        id:
          type: integer
          example: 1234
          readOnly: true
          description: A unique identifier (system-wide) to represent this image
        filename:
          type: string
          example: "/media/images/23987192387509-123908794328.png"
          description: Relative URI to full size image. A fully qualified URI (e.g www.wasteless.com/media/images/...) should NOT be given.
        thumbnailFilename:
          type: string
          example: "/media/images/23987192387509-123908794328_thumbnail.png"
          description: Relative URI to thumbnail of image. A fully qualified URI (e.g www.wasteless.com/media/images/...) should NOT be given.

    Product:
      type: object
      description: Entity for catalogue items in a product catalogue
      required:
        - name
      properties:
        id:
          type: string
          example: 'WATT-420-BEANS'
          description: >
            Developers can choose whether or not to make this a required field (i.e user
            specified vs. auto-generated). In the case that the team automatically
            generates the IDs, they should still allow this field to be present when
            creating (POST) or modifying (PUT) a product, and then simply ignore its
            value (i.e do not return a 400 code if it is present but not needed). An
            ID only needs to be unique within its catalogue, not system-wide.
        name:
          type: string
          description: The full name of the product
          example: "Watties Baked Beans - 420g can"
        description:
          type: string
          description: A desription of the product
          example: "Baked Beans as they should be."
        manufacturer:
          type: string
          description: The manufacturer of the product
          example: "Heinz Wattie's Limited"
        recommendedRetailPrice:
          type: number
          format: double
          example: 2.20
          description: The recommended retail price of the product, given in whatever currency is in use at the business's location.
        created:
          type: string
          format: date-time
          readOnly: true
          description: The date and time when this product was created. This field is generated automatically by the server.
        images:
          type: array
          readOnly: true
          description: List of images of a product (implemented in U16).
          items:
            $ref: '#/components/schemas/Image'
        currencyCountry:
          type: string
          description: The country that the products price is based on. Can be null.
          readOnly: true


    Business:
      type: object
      description: Business account entity
      required:
        - name
        - address
        - businessType
      properties:
        id:
          type: integer
          example: 100
          readOnly: true
          description: Automatically generated and assigned by the server
        administrators:
          type: array
          items:
            $ref: '#/components/schemas/User'
          readOnly: true
        primaryAdministratorId:
          type: integer
          example: 20
          description: "The ID of the 'primary' administrator of the business. This is automatically given to the creator of the business."
        name:
          type: string
          example: 'Lumbridge General Store'
        description:
          type: string
          example: 'A one-stop shop for all your adventuring needs'
        address:
          $ref: '#/components/schemas/Address'
        businessType:
          type: string
          enum:
            - Accommodation and Food Services
            - Retail Trade
            - Charitable organisation
            - Non-profit organisation
        created:
          type: string
          format: date-time
          example: '2020-07-14T14:52:00Z'
          readOnly: true
          description: Date and time when the account was created

    Address:
      type: object
      description: Entity representing some physical address
      required:
        - country
      properties:
        streetNumber:
          type: string
          example: '3/24'
        streetName:
          type: string
          example: 'Ilam Road'
        suburb:
          type: string
          example: 'Upper Riccarton'
        city:
          type: string
          example: 'Christchurch'
        region:
          type: string
          example: 'Canterbury'
        country:
          type: string
          example: 'New Zealand'
        postcode:
          type: string
          example: '90210'

    User:
      type: object
      description: Basic user entity
      required:
        - firstName
        - lastName
        - email
        - dateOfBirth
        - homeAddress
        - password
      properties:
        id:
          type: integer
          example: 100
          readOnly: true
          description: Automatically generated and assigned by the server
        firstName:
          type: string
          example: John
        lastName:
          type: string
          example: Smith
        middleName:
          type: string
          example: Hector
        nickname:
          type: string
          example: Jonny
        bio:
          type: string
          example: Likes long walks on the beach
        email:
          type: string
          format: email
          example: johnsmith99@gmail.com
        dateOfBirth:
          type: string
          format: date
          example: '1999-04-27'
        phoneNumber:
          type: string
          example: '+64 3 555 0129'
        homeAddress:
          $ref: '#/components/schemas/Address'
        password:
          type: string
          example: '1337-H%nt3r2'
          format: password
          writeOnly: true
          description: Should not be stored in plain text (i.e hash it)
        created:
          type: string
          format: date-time
          example: '2020-07-14T14:32:00Z'
          readOnly: true
          description: Date and time when the account was created
        role:
          type: string
          readOnly: true
          description: '(Implemented in U4): This property should only be shown to Global Application Admins'
          enum:
            - user
            - globalApplicationAdmin
            - defaultGlobalApplicationAdmin
        businessesAdministered:
          type: array
          readOnly: true
          description: '(Implemented in U6): A list of businesses for which the user is an administrator'
          items:
            $ref: '#/components/schemas/Business'
        likedSaleListings:
          type: array
          readOnly: true
          description: 'A list of sale listings the user has liked'
          items:
            $ref: '#/components/schemas/LikedSaleListing'


    EditUser:
      type: object
      description: Basic Edit user entity
      required:
        - firstName
        - lastName
        - email
        - dateOfBirth
        - homeAddress
      properties:
        firstName:
          type: string
          example: John
        lastName:
          type: string
          example: Smith
        middleName:
          type: string
          example: Hector
        nickname:
          type: string
          example: Jonny
        bio:
          type: string
          example: Likes long walks on the beach
        email:
          type: string
          format: email
          example: johnsmith99@gmail.com
        dateOfBirth:
          type: string
          format: date
          example: '1999-04-27'
        phoneNumber:
          type: string
          example: '+64 3 555 0129'
        homeAddress:
          $ref: '#/components/schemas/Address'
        newPassword:
          type: string
          example: '1337-H%nt3r2'
          format: password
          writeOnly: true
          description: Only supplied if the user is changing their password, null otherwise
        currentPassword:
          type: string
          example: 'SecurePass123'
          format: password
          writeOnly: true
          description: Only supplied of the user is updating their password or email, null otherwise

    UserNotification:
      type: object
      description: A notification entity for a specific user
      required:
        - id
        - type
        - message
        - created
        - user
      properties:
        id:
          type: integer
          example: 100
          readOnly: true
          description: 'ID of the notification. Automatically generated and assigned by the server.'
        type:
          type: string
          readOnly: true
          description: 'The type of the notification'
          enum:
            - user
            - cardExpiry
        message:
          type: string
          example: 'This is a notification'
          readOnly: true
          description: 'A string message contained within the notification'
        created:
          type: string
          format: date-time
          example: '2020-07-14T14:32:00Z'
          readOnly: true
          description: 'The date and time the notification was created'
        user:
          $ref: '#/components/schemas/User'

    AdminNotification:
      type: object
      description: A notification entity for a specific user
      required:
        - id
        - type
        - message
        - created
      properties:
        id:
          type: integer
          example: 100
          readOnly: true
          description: 'ID of the notification. Automatically generated and assigned by the server.'
        type:
          type: string
          readOnly: true
          description: 'The type of the notification'
          enum:
            - admin
            - newKeyword
        message:
          type: string
          example: 'This is a notification'
          readOnly: true
          description: 'A string message contained within the notification'
        created:
          type: string
          format: date-time
          example: '2020-07-14T14:32:00Z'
          readOnly: true
          description: 'The date and time the notification was created'

    LikedSaleListing:
      type: object
      description: Entity representing a sale listing liked by a user
      required:
        - id
        - user
        - listing
        - starred
        - tag
      properties:
        id:
          type: integer
          example: 100
          readOnly: true
          description: ID of the LikedSaleListing entity. Used for storage in database.
        user:
          $ref: '#/components/schemas/User'
        listing:
          $ref: '#/components/schemas/Listing'
        starred:
          type: boolean
          example: false
          description: Boolean for if a liked sale listing is starred or not
        tag:
          $ref: '#/components/schemas/Tag'
    Tag:
      type: string
      example: 'red'
      description: Tag that the liked sale listing has
      enum:
        - red
        - orange
        - yellow
        - green
        - blue
        - purple
        - none